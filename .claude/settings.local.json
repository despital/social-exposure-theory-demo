{
  "permissions": {
    "allow": [
      "Bash(python:*)",
      "Bash(ls:*)",
      "WebFetch(domain:www.jspsych.org)",
      "Bash(git add:*)",
      "Bash(git commit -m \"$\\(cat <<''EOF''\nAdd Phase 3 post-task rating and comprehensive debug mode\n\nPhase 3 Implementation:\n- Added post-task rating phase where participants rate all encountered faces\n- Two-question format: good/bad binary choice + 6-level confidence rating\n- Face presentation order randomized\n- Progress bar properly distributed across all three phases \\(60%/10%/30%\\)\n- Collects ~200 trials \\(2 per unique face\\)\n\nDebug Mode Features:\n- Basic debug mode: Skip consent/demographics, reduce trial counts\n- Section jumping: Jump directly to any phase \\(consent, demographics, phase1, phase2, phase3, end\\)\n- Simulation mode integration: Visual or data-only automated testing\n- URL parameters: ?debug=true&section=X&simulate=visual\n- Console logging for transparency\n\nTechnical Fixes:\n- Fixed button_html to use function syntax \\(jsPsych v8 compatibility\\)\n- Fixed progress bar overflow \\(was exceeding 1.0 limit\\)\n- Proper scope management for trial generation\n\nFiles Modified:\n- src/experiment.js: Added Phase 3 trials, debug mode, section jumping\n- src/utils/helpers.js: Added generatePhase3Trials\\(\\) function\n- src/utils/config.js: Added DEBUG_MODE and DEBUG_SECTIONS config\n- README.md: Updated with Phase 3 info and debug mode documentation\n- docs/DEV_LOG.md: Added Session 3 entry with comprehensive documentation\n\nCo-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git push:*)",
      "Bash(\"scripts/README.md\" << 'EOF'\n# Data Export Scripts\n\nThis folder contains scripts to download and convert data from Firebase to CSV format for analysis.\n\n## Quick Start\n\n### Python\n```bash\npip install pandas requests\npython scripts/firebase_to_csv.py\n```\n\n### R\n```r\ninstall.packages\\(c\\(\"jsonlite\", \"dplyr\", \"tidyr\", \"purrr\"\\)\\)\nsource\\(\"scripts/firebase_to_csv.R\"\\)\nexport_all\\(\\)\n```\n\n## Output Files \\(in data/csv_exports/\\)\n- **participants.csv** - Metadata, conditions, summary scores\n- **demographics.csv** - Demographics responses\n- **phase1_trials.csv** - All Phase 1 trials\n- **phase2_trials.csv** - All Phase 2 trials  \n- **phase3_trials.csv** - All Phase 3 trials \\(ratings + confidence\\)\n- **surveys.csv** - Technical check + user feedback\n\n## Firebase Structure\n```\nparticipants/\n  {participant_id}/\n    metadata: {internal_id, prolific_pid, condition, ...}\n    demographics: {...}\n    summary: {phase1_score, phase2_score, total_score}\n    trials: {phase1: [...], phase2: [...], phase3: [...]}\n    surveys: {technical_check: {...}, user_feedback: {...}}\n```\nEOF)",
      "Bash(\"docs/FIREBASE_SETUP.md\" << 'EOF'\n# Firebase Setup and Data Structure\n\n## Overview\n\nThis document describes the Firebase integration and optimized data structure for the Social Exposure Theory experiment.\n\n## Current Status\n\n✅ **Completed**:\n- Firebase credentials integrated \\(Social Exposure Theory 2026\\)\n- Optimized data structure implemented\n- CSV export scripts created \\(Python & R\\)\n- Documentation updated\n\n⚠️ **Testing Phase**:\n- Data saving currently **DISABLED** \\(`DISABLE_DATA_SAVING: true`\\)\n- Enable for production: Set to `false` in `src/utils/config.js`\n\n## What Changed\n\n### OLD Structure \\(Problematic\\)\n```\n{random_firebase_uid}/\n  {random_10_digit_number}/\n    data: [all trials nested in array]\n    study: 'social_exposure_theory_phase1'\n    date: 'Thu Feb 06 2026...'\n```\n\n**Problems**:\n- Random UIDs made it hard to identify participants\n- Random session numbers had no meaning\n- All data buried under \"data\" array\n- Not analysis-ready\n- Required custom script to unnest before use\n\n### NEW Structure \\(Optimized\\)\n```\nparticipants/\n  {participant_id}/              # Uses Prolific PID or internal_XXXXX\n    metadata:\n      internal_id               # Always generated\n      prolific_pid              # From URL parameter\n      study_id                  # From Prolific\n      session_id                # From Prolific\n      condition                 # Experiment condition\n      majority_group            # red/blue\n      informed                  # true/false\n      timestamp                 # ISO format\n      debug_mode                # Filter test data\n    demographics: {...}\n    summary:\n      phase1_score\n      phase2_score\n      total_score\n      *_trials_count\n    trials:\n      phase1: [array of Phase 1 trials]\n      phase2: [array of Phase 2 trials]\n      phase3: [array of Phase 3 trials]\n    surveys:\n      technical_check: {...}\n      user_feedback: {...}\n```\n\n**Advantages**:\n- ✅ Meaningful participant IDs\n- ✅ Metadata at top level\n- ✅ Organized by phase\n- ✅ Easy to query and filter\n- ✅ Direct CSV export\n- ✅ Handles missing Prolific IDs gracefully\n\n## Participant ID Strategy\n\nThe system uses a **dual ID approach**:\n\n1. **Prolific PID** \\(Primary\\): Used as `participant_id` when available\n2. **Internal ID** \\(Fallback\\): `internal_XXXXX` generated if Prolific PID missing\n3. **Both stored**: `internal_id` always created for backup\n\nThis ensures:\n- Data never lost if Prolific parameters fail\n- Easy to identify Prolific participants\n- Can link back to Prolific for payments\n\n## How to Enable Data Saving\n\n1. **Test First** \\(Recommended\\):\n   ```javascript\n   // In src/utils/config.js\n   DISABLE_DATA_SAVING: false  // Enable saving\n   ```\n\n2. **Run a test participant**:\n   ```\n   http://localhost:8080?participant_id=TEST_001\n   ```\n\n3. **Check Firebase Console**:\n   - Go to https://console.firebase.google.com\n   - Select \"Social Exposure Theory 2026\" project\n   - Navigate to Realtime Database\n   - Look for `participants/TEST_001`\n\n4. **Verify structure**:\n   - Check metadata is present\n   - Verify trials are separated by phase\n   - Confirm demographics captured\n\n5. **Export to CSV**:\n   ```bash\n   python scripts/firebase_to_csv.py\n   ```\n\n6. **Check output**:\n   - Should see 6 CSV files in `data/csv_exports/`\n   - Open in Excel/R to verify\n\n## Firebase Security Rules \\(TODO\\)\n\nBefore production, set up security rules:\n\n```json\n{\n  \"rules\": {\n    \"participants\": {\n      \"$participant_id\": {\n        \".write\": \"auth != null && !data.exists\\(\\)\",\n        \".read\": \"auth != null\"\n      }\n    }\n  }\n}\n```\n\nThis ensures:\n- Participants can only write once \\(no overwriting\\)\n- Must be authenticated \\(anonymous auth\\)\n- Only authenticated users can read\n\n## Data Export Workflow\n\n### Option 1: Python\n```bash\npip install pandas requests\npython scripts/firebase_to_csv.py\n```\n\n### Option 2: R  \n```r\ninstall.packages\\(c\\(\"jsonlite\", \"dplyr\", \"tidyr\", \"purrr\"\\)\\)\nsource\\(\"scripts/firebase_to_csv.R\"\\)\nexport_all\\(\\)\n```\n\nBoth create:\n- `participants.csv` - One row per participant\n- `phase1_trials.csv` - All Phase 1 trials \\(long format\\)\n- `phase2_trials.csv` - All Phase 2 trials\n- `phase3_trials.csv` - All Phase 3 trials\n- `demographics.csv` - Demographics responses\n- `surveys.csv` - Survey responses\n\n### Example Analysis \\(R\\)\n```r\nlibrary\\(dplyr\\)\n\n# Load data\nparticipants <- read.csv\\('data/csv_exports/participants.csv'\\)\nphase1 <- read.csv\\('data/csv_exports/phase1_trials.csv'\\)\n\n# Filter real participants \\(exclude debug\\)\nreal_data <- participants %>%\n  filter\\(debug_mode == FALSE\\)\n\n# Merge trials with participant info\ntrials_full <- phase1 %>%\n  inner_join\\(real_data, by = 'participant_id'\\)\n\n# Analyze by condition\ncondition_summary <- trials_full %>%\n  group_by\\(condition, participant_id\\) %>%\n  summarize\\(avg_score = mean\\(outcome\\)\\)\n```\n\n## Troubleshooting\n\n### \"Data not saving\"\n- Check `DISABLE_DATA_SAVING: false`\n- Verify Firebase credentials correct\n- Check browser console for errors\n- Ensure internet connection\n\n### \"Empty CSVs\"\n- Verify data exists in Firebase Console\n- Check database URL in export script\n- Confirm `/participants` path exists\n\n### \"Missing Prolific ID\"\n- Check URL parameters passed correctly\n- Verify `participant_id` parameter present\n- Falls back to `internal_XXXXX` if missing\n\n## Next Steps\n\n1. ✅ Test with one participant\n2. ✅ Verify data structure in Firebase\n3. ✅ Export and check CSVs\n4. ⬜ Set up Firebase security rules\n5. ⬜ Deploy to production\n6. ⬜ Test with Prolific integration\n\n## Questions?\n\nSee also:\n- [scripts/README.md]\\(../scripts/README.md\\) - Export script documentation\n- [README.md]\\(../README.md\\) - Main project documentation\n- [docs/TODO.md]\\(TODO.md\\) - Implementation checklist\nEOF)",
      "Bash(tasklist:*)",
      "Bash(findstr:*)",
      "Bash(git checkout:*)",
      "Bash(git stash:*)",
      "Bash(npm run build:*)",
      "Bash(npx webpack:*)",
      "Bash(npm install:*)"
    ]
  }
}
